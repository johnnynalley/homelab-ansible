# =============================================================================
# pve-m70q - Proxmox Node + VM Firewall Configuration
# =============================================================================

pve_node_firewall:
  enable: true
  rules:
    - { type: group, name: "corosync-lan", comment: "Cluster heartbeat" }
    - { action: ACCEPT, iface: vmbr0, proto: tcp, dport: 8006, comment: "Proxmox API (LAN)" }
    - { action: ACCEPT, iface: vmbr0, proto: tcp, dport: 22, comment: "SSH (LAN)" }
    - { action: ACCEPT, iface: tailscale0, proto: tcp, dport: 8006, comment: "Proxmox API (Tailscale)" }
    - { action: ACCEPT, iface: tailscale0, proto: tcp, dport: 22, comment: "SSH (Tailscale)" }
    # apcupsd NIS (UPS master - serves status to all Proxmox nodes)
    - { action: ACCEPT, iface: tailscale0, proto: tcp, dport: 3551, comment: "apcupsd NIS (Tailscale)" }
    - { action: ACCEPT, iface: vmbr0, proto: tcp, dport: 3551, comment: "apcupsd NIS (LAN)" }

    - { action: ACCEPT, iface: tailscale0, proto: icmp, comment: "Ping (Tailscale)" }
    - { action: DROP, comment: "Default deny" }

pve_vm_firewalls:
  # docker-vm (VM 110)
  110:
    enable: true
    policy_in: DROP
    rules:
      - { action: ACCEPT, proto: tcp, dport: 22, comment: "SSH" }
      - { action: ACCEPT, proto: tcp, dport: 443, comment: "HTTPS (Caddy)" }
      - { action: ACCEPT, proto: tcp, dport: 80, comment: "HTTP (Caddy redirect)" }
