# =============================================================================
# NFS Playbook - Server and Client Configuration
# =============================================================================
# Usage: ansible-playbook playbooks/nfs.yml
#        ansible-playbook playbooks/nfs.yml --limit ts440
#        ansible-playbook playbooks/nfs.yml --tags client
# =============================================================================

- name: Configure NFS server
  hosts: nas_server
  become: true
  gather_facts: true

  tasks:
    - name: Setup NFS server
      ansible.builtin.import_tasks: ../tasks/nfs-server.yml
      when: nfs_exports is defined
      tags: [nfs, server]

  handlers:
    - name: Reload NFS exports
      ansible.builtin.command: exportfs -ra

    - name: Reload systemd
      ansible.builtin.systemd:
        daemon_reload: true


- name: Configure NFS clients
  hosts: linux_hosts
  become: true
  gather_facts: true

  tasks:
    - name: Setup NFS client mounts
      ansible.builtin.import_tasks: ../tasks/nfs-client.yml
      when: nfs_mounts is defined
      tags: [nfs, client]
