# =============================================================================
# Filesystem Mounts (NTFS, exFAT, etc.)
# =============================================================================
# For local drives that aren't NFS
# Expects variable: filesystem_mounts (list of mount definitions)

- name: Install NTFS support (Debian)
  ansible.builtin.apt:
    name: ntfs-3g
    state: present
  when:
    - ansible_facts.os_family == "Debian"
    - filesystem_mounts | selectattr('fstype', 'match', 'ntfs.*') | list | length > 0

- name: Install NTFS support (Arch)
  community.general.pacman:
    name: ntfs-3g
    state: present
  when:
    - ansible_facts.os_family == "Archlinux"
    - filesystem_mounts | selectattr('fstype', 'match', 'ntfs.*') | list | length > 0

- name: Create mount point directories
  ansible.builtin.file:
    path: "{{ item.path }}"
    state: directory
    owner: "{{ item.owner | default('root') }}"
    group: "{{ item.group | default('root') }}"
    mode: "{{ item.mode | default('0755') }}"
  loop: "{{ filesystem_mounts }}"

- name: Mount filesystems
  ansible.posix.mount:
    path: "{{ item.path }}"
    src: "{{ item.src }}"
    fstype: "{{ item.fstype }}"
    opts: "{{ item.opts | default('defaults,nofail') }}"
    state: mounted
  loop: "{{ filesystem_mounts }}"
