# =============================================================================
# Docker Network Management
# =============================================================================
# Ensures Docker networks exist on hosts with docker_networks defined
# Usage: Include this task file before deploying stacks that need networks
# =============================================================================

- name: Check if Docker network exists
  ansible.builtin.shell: docker network inspect {{ item.name }} > /dev/null 2>&1
  loop: "{{ docker_networks | default([]) }}"
  loop_control:
    label: "{{ item.name }}"
  register: network_check
  failed_when: false
  changed_when: false
  when: docker_networks is defined and docker_networks | length > 0

- name: Create Docker networks
  ansible.builtin.shell: docker network create {{ item.item.name }}
  loop: "{{ network_check.results | default([]) }}"
  loop_control:
    label: "{{ item.item.name }}"
  when:
    - network_check.results is defined
    - item.rc != 0
  changed_when: true
